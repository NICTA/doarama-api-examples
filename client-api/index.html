<!DOCTYPE html>
<html>

<body>

  <p>
    <input type="button" value="Play" onclick="wrapPost('setPlaying',true)">
    <input type="button" value="Pause" onclick="wrapPost('setPlaying',false)">
    <input type="button" value="Hide Stats" onclick="wrapPost('setStatsVisibility',false)">
    <input type="button" value="Show Stats" onclick="wrapPost('setStatsVisibility',true)">
    <input type="button" value="Hide Chart" onclick="wrapPost('setChartVisibility',false)">
    <input type="button" value="Show Chart" onclick="wrapPost('setChartVisibility',true)">
  </p>

  <!-- Some defaults URL arguments provided for testing -->
  <iframe id="doarama-iframe" src="http://api.doarama.com/api/0.2/visualisation?k=VeB4BLE&name=Name%20One&name=Name%20Two&name=Name%20Three&name=Name%20Four&name=Name%20Five&avatarBaseUrl=http%3A%2F%2Fmonster-hash.herokuapp.com%2Fmonsterid%2F" width="940px" height="420px" frameborder="0"
    webkitAllowFullScreen mozAllowFullScreen allowFullScreen></iframe>

  <script>
      var apiDomain = 'http://api.doarama.com';
      var apiReady = false;

      // Access the iframe's content window
      var player = document.getElementById('doarama-iframe').contentWindow;

      // Receive messages from the API
      function onMessageReceived(e) {
        if (e.data.method === 'ready') {
          apiReady = true;
          console.log('API is ready!');
        } else {
          console.log('client received: ' + JSON.stringify(e.data));
        }
      }

      window.addEventListener('message', onMessageReceived, false);

      // Only allow posting messages once API is ready
      function wrapPost(method, value) {
        var msg = {"method" : method, "value" : value};
        if (apiReady) {
          player.postMessage(msg, apiDomain);
        } else {
          alert("Doarama Client API not ready yet!");
        }
      }

    </script>

</body>
</html>
